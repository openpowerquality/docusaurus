<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Deployment: Docker · Open Power Quality</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Deployment: Docker · Open Power Quality"/><meta property="og:type" content="website"/><meta property="og:url" content="https://openpowerquality.org/index.html"/><meta property="og:description" content="## Overview"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/opq.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://openpowerquality.org/blog/atom.xml" title="Open Power Quality Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://openpowerquality.org/blog/feed.xml" title="Open Power Quality Blog RSS Feed"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gugi"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type="text/javascript" src="/js/mathjax-config.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible doc separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/opqlogo_white.png" alt="Open Power Quality"/><h2 class="headerTitleWithLogo">Open Power Quality</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/intro-motivation.html" target="_self">Documentation</a></li><li class="siteNavGroupActive"><a href="/docs/other-opportunities.html" target="_self">Opportunities</a></li><li class=""><a href="/blog" target="_self">News</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Deployment</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/docs/intro-motivation.html">Motivation for OPQ</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-power-quality.html">A beginner&#x27;s guide to power quality</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-system-architecture.html">OPQ System Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-information-architecture.html">OPQ Information Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-related-work.html">Related Work</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-bibliography.html">Bibliography</a></li></ul></div><div class="navGroup navGroupActive"><h3>User Guide</h3><ul><li class="navListItem"><a class="navItem" href="/docs/userguide-hardware.html">OPQ Box</a></li><li class="navListItem"><a class="navItem" href="/docs/userguide-software.html">OPQ Cloud</a></li></ul></div><div class="navGroup navGroupActive"><h3>OPQ Box</h3><ul><li class="navListItem"><a class="navItem" href="/docs/box-overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/box-hardware-design.html">Hardware Design</a></li><li class="navListItem"><a class="navItem" href="/docs/box-software-design.html">Software Design</a></li><li class="navListItem"><a class="navItem" href="/docs/box-updater.html">Updater</a></li><li class="navListItem"><a class="navItem" href="/docs/box-manufacturing.html">Manufacturing</a></li></ul></div><div class="navGroup navGroupActive"><h3>OPQ Cloud</h3><ul><li class="navListItem"><a class="navItem" href="/docs/cloud-overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-datamodel.html">Data Model</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-view.html">View</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-mauka.html">Mauka</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-makai.html">Makai</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-health.html">Health</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-protocol.html">Protocol</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-port-map.html">Port Map</a></li></ul></div><div class="navGroup navGroupActive"><h3>Misc Development</h3><ul><li class="navListItem"><a class="navItem" href="/docs/developerguide-docusaurus.html">Documentation</a></li><li class="navListItem"><a class="navItem" href="/docs/developerguide-virtual-machine.html">VM &amp; Sim</a></li><li class="navListItem"><a class="navItem" href="/docs/developerguide-bibliography.html">Bibliography</a></li></ul></div><div class="navGroup navGroupActive"><h3>Deployment</h3><ul><li class="navListItem"><a class="navItem" href="/docs/deploy-initial-configuration.html">Initial Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-mongodb.html">MongoDB</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-mauka.html">Mauka</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-makai.html">Makai</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-view.html">View</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-health.html">Health</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/deploy-docker.html">Docker</a></li></ul></div><div class="navGroup navGroupActive"><h3>Other</h3><ul><li class="navListItem"><a class="navItem" href="/docs/other-roadmap.html">Roadmap</a></li><li class="navListItem"><a class="navItem" href="/docs/other-opportunities.html">R&amp;D Opportunities</a></li><li class="navListItem"><a class="navItem" href="/docs/other-agile-power-monitoring.html">Agile Power Monitoring for UH</a></li><li class="navListItem"><a class="navItem" href="/docs/other-g1-pilot-study.html">G1 Pilot Study (2014)</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Deployment: Docker</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="overview"></a><a href="#overview" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview</h2>
<p>We utilize <a href="https://www.docker.com/">Docker</a> to containerize each of our services into easy-to-deploy bundles. In combination with <a href="https://docs.docker.com/compose/">Docker Compose</a>, the task of deploying and running a new OPQ Cloud instance has become a greatly simplified process.</p>
<p>This guide will be covering three separate concerns:</p>
<ol>
<li>Deploying a new OPQ Cloud instance on production</li>
<li>Creating new OPQ docker images</li>
<li>Publishing new OPQ docker images</li>
</ol>
<p>Since we provide our own <a href="https://hub.docker.com/u/openpowerquality">official OPQ releases</a> on DockerHub, you are free to skip the image building and publishing process entirely if you are only interested in deploying an official OPQ release.</p>
<p>To illustrate the simplicity of deploying an official OPQ release with Docker, we will discuss that process first.</p>
<p>Then, we will discuss how to build your own Docker images, as well as how to push them to DockerHub.</p>
<p>Note: We are still in the process of Dockerizing our OPQ services. The following lists the Dockerized services and the location of their Docker-related files:</p>
<ul>
<li>View: <code>opq/view/docker</code></li>
<li>Mauka: <code>opq/mauka/docker</code></li>
<li>Health: <code>opq/health/docker</code></li>
<li>Box Updater: <code>opq/util/box-update-server/docker</code></li>
<li>Mongo: No files necessary; we use the official Mongo image without modification.</li>
</ul>
<h3><a class="anchor" aria-hidden="true" id="pre-requisites"></a><a href="#pre-requisites" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pre-requisites</h3>
<p>Make sure you have Docker and Docker-Compose installed on your development and production systems.</p>
<p>Please refer to the official <a href="https://docs.docker.com/install/">Docker documentation</a> for installation instructions.</p>
<p>Also see the official <a href="https://docs.docker.com/compose/install/">Docker-Compose documentation</a>.</p>
<h3><a class="anchor" aria-hidden="true" id="overview-of-docker-related-files"></a><a href="#overview-of-docker-related-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Overview of Docker-related files</h3>
<p>There are two sets of Docker-related files to be aware of:</p>
<ol>
<li>Individual OPQ service Docker files, found in each service's respective <code>/docker</code> subdirectory (e.g. <code>opq/view/docker</code>).</li>
<li>Docker-Compose files, found in the <code>opq/util/docker-deployment</code> directory.</li>
<li>Docker deployment utility files, found in the <code>opq/util/docker-utils</code> directory.</li>
</ol>
<h4><a class="anchor" aria-hidden="true" id="dockerized-opq-service-files"></a><a href="#dockerized-opq-service-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dockerized OPQ service files</h4>
<p>Each Dockerized OPQ service has a <code>/docker</code> subdirectory with a common set of files:</p>
<ul>
<li><code>Dockerfile</code>: Contains the configuration for building the Docker image. Used by the <code>docker-build.sh</code> script.</li>
<li><code>docker-build.sh</code>: A script for building a new Docker image.</li>
<li><code>docker-publish.sh</code>: A script for publishing a new image to DockerHub.</li>
<li><code>docker-run.sh</code>: A script for running the docker image as a standalone instance. Note that we actually use Docker-Compose to handle the task of running all OPQ images together, so this file is generally only used for debugging purposes.</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="docker-compose-files"></a><a href="#docker-compose-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Docker-Compose files</h4>
<p>Docker-Compose is responsible for orchestrating how each of our OPQ services work together.</p>
<p>These files can be found in the <code>opq/util/docker-deployment</code> directory:</p>
<ul>
<li><code>docker-compose.yml</code>: The configuration file for Docker-Compose.</li>
<li><code>.env</code>: Contains environment variables that are substituted into the docker-compose.yml file.</li>
<li><code>docker-compose-run.sh</code>: A script for launching Docker-Compose. Also defines additional environment variables.</li>
</ul>
<h4><a class="anchor" aria-hidden="true" id="utility-files"></a><a href="#utility-files" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Utility files</h4>
<p>The files found in the <code>opq/util/docker-utils</code> directory are helper scripts meant to aid with the deployment of OPQ on the Emilia server:</p>
<ul>
<li><code>deploy-transfer.sh</code>: Transfers latest deployment related files to the Emilia server.</li>
<li><code>docker-prepare-and-run.sh</code>: Helper script that copies (and overwrites existing) deployment files into the dedicated deployment directory on Emilia, before invoking the <code>docker-compose-run.sh</code> script to initiate (re)deployment.</li>
</ul>
<h2><a class="anchor" aria-hidden="true" id="deployment"></a><a href="#deployment" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deployment</h2>
<p>Before we begin, make sure you have Docker and Docker-Compose installed on your production system.</p>
<p>The <code>opq/util/docker-deployment</code> directory contains all the files required for deployment.</p>
<p>Deployment is a very straight-forward process:</p>
<ol>
<li>Transfer the latest contents of the <code>opq/util/docker-deployment</code> directory into a dedicated deployment directory of your choice on your production server, overwriting all older deployment files as necessary.</li>
<li>Invoke the <code>docker-compose-run.sh</code> script to re-deploy the OPQ Cloud instance.</li>
</ol>
<p>This is essentially all that is required to deploy your own OPQ Cloud instance.</p>
<p>However, OPQ developers deploying on the Emilia server can (and should) use the helper scripts we provide to streamline
this entire process. The deployment walk-through below details this further.</p>
<h3><a class="anchor" aria-hidden="true" id="deployment-walk-through"></a><a href="#deployment-walk-through" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Deployment Walk-through</h3>
<p>Note: This deployment walk-through is specific for OPQ developers deploying on the Emilia server.</p>
<h4><a class="anchor" aria-hidden="true" id="transfer-deployment-files-to-production-server"></a><a href="#transfer-deployment-files-to-production-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Transfer deployment files to production server</h4>
<p>Invoke the <code>deploy-transfer.sh</code> script found in the <code>opq/util/docker-utils</code> directory.</p>
<p>This script creates a timestamp-named directory, copies the contents of the <code>opq/util/docker-deployment</code> directory into it (as well as the <code>docker-prepare-and-run.sh</code> helper script),
gzips the new directory, and then secure copies it to the Emilia server under the <code>/home/opquser/docker/transfers</code> directory.</p>
<pre><code class="hljs">$ ./deploy-transfer.sh
<span class="hljs-addition">++ date +%Y%m%d_%H%M%S</span>
<span class="hljs-addition">+ timestamp=20190219_123528</span>
<span class="hljs-addition">+ mkdir 20190219_123528</span>
<span class="hljs-addition">+ cp ../docker-deployment/docker-compose.yml 20190219_123528</span>
<span class="hljs-addition">+ cp ../docker-deployment/docker-compose-run.sh 20190219_123528</span>
<span class="hljs-addition">+ cp ../docker-deployment/.env 20190219_123528</span>
<span class="hljs-addition">+ cp docker-prepare-and-run.sh 20190219_123528</span>
<span class="hljs-addition">+ tar czf 20190219_123528.tar.gz 20190219_123528</span>
<span class="hljs-addition">+ rm -rf 20190219_123528</span>
<span class="hljs-addition">+ EMILIA_DOCKER_TRANSFER_DIR=/home/opquser/docker/transfers</span>
<span class="hljs-addition">+ scp -P 29862 20190219_123528.tar.gz opquser@emilia.ics.hawaii.edu:/home/opquser/docker/transfers</span>
opquser@emilia.ics.hawaii.edu's password:
20190219_123528.tar.gz                                                                                                                                                                                      100% 2169     2.1KB/s   00:01
<span class="hljs-addition">+ set +x</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="extract-deployment-files-on-production-server"></a><a href="#extract-deployment-files-on-production-server" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Extract deployment files on production server</h4>
<p>Now we need to unpack the deployment files that we had just transferred.</p>
<p>First, ssh to the server with the proper credentials:</p>
<pre><code class="hljs">ssh -<span class="hljs-selector-tag">p</span> <span class="hljs-number">29862</span> opquser@emilia<span class="hljs-selector-class">.ics</span><span class="hljs-selector-class">.hawaii</span><span class="hljs-selector-class">.edu</span>
</code></pre>
<p>Change into the <code>docker/transfers</code> subdirectory, and list the files:</p>
<pre><code class="hljs">opquser@emilia:~$ cd docker/transfers
opquser@emilia:~/docker/transfers$ ls -al
total 20
drwxr-xr-x<span class="hljs-number"> 3 </span>opquser opquser<span class="hljs-number"> 4096 </span>Feb<span class="hljs-number"> 19 </span>07:38 .
drwxr-xr-x<span class="hljs-number"> 4 </span>opquser opquser<span class="hljs-number"> 4096 </span>Feb<span class="hljs-number"> 18 </span>17:40 ..
drwxr-xr-x<span class="hljs-number"> 2 </span>opquser opquser<span class="hljs-number"> 4096 </span>Feb<span class="hljs-number"> 18 </span>17:00 20190206_144024
-rw-r--r--<span class="hljs-number"> 1 </span>opquser opquser<span class="hljs-number"> 1201 </span>Feb<span class="hljs-number"> 18 </span>15:25 20190206_144024.tar.gz
-rw-r--r--<span class="hljs-number"> 1 </span>opquser opquser<span class="hljs-number"> 2169 </span>Feb<span class="hljs-number"> 19 </span>07:35 20190219_123528.tar.gz
</code></pre>
<p>You may see one or more timestamped tar.gz files and directories. Each of these correspond to a previous deployment transfer.
While it's generally a good idea to keep this directory clean, it can be useful to keep at least one previous deployment in this directory to fall back on, just in case a problem is encountered with the latest deployment.</p>
<p>The most recently timestamped tar.gz file will be the one that you had just transferred over.
Extract it:</p>
<pre><code class="hljs">opquser<span class="hljs-variable">@emilia</span><span class="hljs-symbol">:~/docker/transfers</span><span class="hljs-variable">$ </span>tar xf <span class="hljs-number">20190219_123528</span>.tar.gz
</code></pre>
<p>Change into the extracted directory and list all files:</p>
<pre><code class="hljs">opquser@emilia:~/docker/transfers$ cd 20190219_123528
opquser@emilia:~/docker/transfers/20190219_123528$ ls -al
total 24
drwxr-xr-x<span class="hljs-number"> 2 </span>opquser opquser<span class="hljs-number"> 4096 </span>Feb<span class="hljs-number"> 19 </span>07:35 .
drwxr-xr-x<span class="hljs-number"> 4 </span>opquser opquser<span class="hljs-number"> 4096 </span>Feb<span class="hljs-number"> 19 </span>07:40 ..
-rwxr-xr-x<span class="hljs-number"> 1 </span>opquser opquser <span class="hljs-number"> 571 </span>Feb<span class="hljs-number"> 19 </span>07:35 docker-compose-run.sh
-rw-r--r--<span class="hljs-number"> 1 </span>opquser opquser<span class="hljs-number"> 2463 </span>Feb<span class="hljs-number"> 19 </span>07:35 docker-compose.yml
-rwxr-xr-x<span class="hljs-number"> 1 </span>opquser opquser <span class="hljs-number"> 591 </span>Feb<span class="hljs-number"> 19 </span>07:35 docker-prepare-and-run.sh
-rw-r--r--<span class="hljs-number"> 1 </span>opquser opquser<span class="hljs-number"> 2258 </span>Feb<span class="hljs-number"> 19 </span>07:35 .env
</code></pre>
<p>You might be surprised how few files we have here, but that is the beauty of Docker and Docker-Compose.
Since the OPQ images are hosted on DockerHub, Docker will simply pull them from the cloud if they have not been downloaded yet on the host system.</p>
<h4><a class="anchor" aria-hidden="true" id="run-the-new-opq-cloud-instance"></a><a href="#run-the-new-opq-cloud-instance" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Run the new OPQ Cloud instance</h4>
<p>Finally, invoke the <code>docker-prepare-and-run.sh</code> script to deploy the latest OPQ Cloud instance:</p>
<pre><code class="hljs">opquser@emilia:~/docker/transfers/<span class="hljs-number">20190219</span>_123528<span class="hljs-symbol">$</span> ./docker-prepare-<span class="hljs-keyword">and</span>-run.sh
<span class="hljs-function"><span class="hljs-title">Creating</span></span> deployment_boxupdateserver_1 ... done
<span class="hljs-function"><span class="hljs-title">Creating</span></span> deployment_mongo_1           ... done
<span class="hljs-function"><span class="hljs-title">Creating</span></span> deployment_view_1            ... done
<span class="hljs-function"><span class="hljs-title">Creating</span></span> deployment_mauka_1           ... done
<span class="hljs-function"><span class="hljs-title">Creating</span></span> deployment_health_1          ... done
</code></pre>
<p>We're deployed! The <code>docker-prepare-and-run.sh</code> file is a simple helper script that does two things for us:</p>
<ol>
<li>Copies the extracted deployment files to our dedicated deployment directory at <code>/home/opquser/docker/deployment</code>, overwriting previous deployment files as necessary.</li>
<li>Invokes the Docker-Compose run script <code>docker-compose-run.sh</code> to (re)deploy the OPQ Cloud instance. Docker-Compose is intelligent enough to detect the difference of deployment files and will only re-deploy the necessary services for us.</li>
</ol>
<p>You may verify that the Docker containers are up and running with the <code>docker ps</code> command.</p>
<h2><a class="anchor" aria-hidden="true" id="developer-tasks"></a><a href="#developer-tasks" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Developer Tasks</h2>
<p>The following sections will cover how to:</p>
<ol>
<li>Create a new image for a given OPQ service.</li>
<li>Publish images to the official OPQ DockerHub repository.</li>
</ol>
<p>The general workflow will involve performing these tasks sequentially - first creating the new image, and then publishing it to the official DockerHub repository.</p>
<p>Each dockerized OPQ service has its own <code>/docker</code> subdirectory containing scripts that greatly simplify these two tasks.</p>
<p>When creating and publishing a new image for an OPQ service, there are three files that you need to be concerned about:</p>
<ol>
<li>The <code>docker-build.sh</code> script, found in the <code>opq/&lt;service-name&gt;/docker</code> directory.</li>
<li>The <code>docker-publish.sh</code> script, also found in the <code>opq/&lt;service-name&gt;/docker</code> directory.</li>
<li>The <code>.env</code> file, found in the <code>opq/util/docker-deployment</code> directory.</li>
</ol>
<p>The <code>.env</code> file is a special Docker-Compose file that we also utilize when publishing new images. This is explained in further detail below.</p>
<h3><a class="anchor" aria-hidden="true" id="creating-new-docker-images"></a><a href="#creating-new-docker-images" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Creating new Docker images</h3>
<p>Creating a new Docker image for a given OPQ service is simply just a matter of invoking its <code>docker-build.sh</code> script.</p>
<p>To build a new Docker image for a given OPQ service:</p>
<ol>
<li><code>cd</code> into the service's <code>/docker</code> subdirectory (e.g. opq/view/docker).</li>
<li>Invoke the <code>docker-build.sh</code> script, and wait for the build process to complete.</li>
</ol>
<p>That's it! Each OPQ service's respective <code>docker-build.sh</code> script might have varying output due to differences in that service's build process,
but the end result will always be the same: a new Docker image named <code>&lt;opq-service-name&gt;:latest</code>.</p>
<p>Once the script has finished running, you should confirm that the image has been successfully created by invoking the <code>docker image ls</code> command.</p>
<p>Since our build scripts do not explicitly provide an image tag for the build process, the <code>latest</code> tag is automatically provided for us.
This is important to note, because as we will explain below, each OPQ service's <code>docker-publish.sh</code> script will, by default, rename and push this <code>&lt;opq-service-name&gt;:latest</code> image to DockerHub.</p>
<h3><a class="anchor" aria-hidden="true" id="publishing-images-to-dockerhub"></a><a href="#publishing-images-to-dockerhub" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Publishing images to DockerHub</h3>
<p>Note: Before continuing, make sure you have obtained the credentials for the official OPQ DockerHub account.</p>
<p>Publishing a new Docker image for a given OPQ service a straight-forward process:</p>
<ol>
<li>If publishing a <strong>new</strong> version of an image, modify the appropriate variable in the <code>opq/util/docker-deployment/.env</code> file with the new image version tag.</li>
<li>Login to the official OPQ DockerHub account by invoking <code>docker login</code> and enter your credentials. If you are already logged-in but unsure which account you are on, you may invoke <code>docker logout</code> first.</li>
<li><code>cd</code> into the service's <code>/docker</code> subdirectory (e.g. <code>opq/mauka/docker</code>) and invoke the <code>docker-publish.sh</code> script.</li>
<li>If you modified the <code>.env</code> file, commit and push it to GitHub with a useful message (e.g. <code>Publish Mauka 0.1.1</code>).</li>
</ol>
<p>As we explain below, the <code>.env</code> file is actually a special Docker-Compose file.
For now, you just need to understand that the <code>.env</code> file has an environment variable definition for each OPQ service's DockerHub repository image name.</p>
<p>Each OPQ service's <code>docker-publish.sh</code> script parses the <code>.env</code> file for the appropriate variable so that it knows exactly how to tag and push the new image.
If this sounds confusing, it's really not! Let's look at an example below:</p>
<h4><a class="anchor" aria-hidden="true" id="publishing-walk-through"></a><a href="#publishing-walk-through" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Publishing Walk-through</h4>
<p>Assume that we just created a new Mauka image by invoking its <code>docker-build.sh</code> script.
The newly created image is automatically named <code>opqmauka:latest</code>, which you can confirm by invoking <code>docker image ls</code>.</p>
<h4><a class="anchor" aria-hidden="true" id="update-the-env-file"></a><a href="#update-the-env-file" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Update the <code>.env</code> file</h4>
<p>Our goal is to publish this new image to DockerHub, also giving it a new version <code>0.1.1</code> (previously <code>0.1.0</code>)</p>
<p><strong>Prior</strong> to publishing the new Mauka image, the <code>.env</code> file (found in <code>opq/util/docker-deployment</code>) might look like the following:</p>
<pre><code class="hljs"><span class="hljs-attr">MAUKA_IMAGE</span>=openpowerquality/opqmauka:<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span>
<span class="hljs-attr">HEALTH_IMAGE</span>=openpowerquality/opqhealth:<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span>
<span class="hljs-attr">VIEW_IMAGE</span>=openpowerquality/opqview:<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span>
</code></pre>
<p>With the goal of publishing a new Mauka image (version 0.1.1), simply modify the <code>MAUKA_IMAGE</code> variable in the <code>.env</code> file, like so:</p>
<pre><code class="hljs"><span class="hljs-attr">MAUKA_IMAGE</span>=openpowerquality/opqmauka:<span class="hljs-number">0.1</span>.<span class="hljs-number">1</span>
<span class="hljs-attr">HEALTH_IMAGE</span>=openpowerquality/opqhealth:<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span>
<span class="hljs-attr">VIEW_IMAGE</span>=openpowerquality/opqview:<span class="hljs-number">0.1</span>.<span class="hljs-number">0</span>
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="login-to-dockerhub"></a><a href="#login-to-dockerhub" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Login to DockerHub</h4>
<p>Obtain the official OPQ DockerHub account credentials, and then invoke <code>docker login</code>.</p>
<p>If you are unsure which account you are currently logged into, you may invoke <code>docker logout</code> first.</p>
<pre><code class="hljs">$ docker login
Login <span class="hljs-keyword">with</span> your Docker ID <span class="hljs-keyword">to</span> push <span class="hljs-keyword">and</span> pull images <span class="hljs-keyword">from</span> Docker Hub. <span class="hljs-keyword">If</span> you don<span class="hljs-comment">'t have a Docker ID, head over to https://hub.docker.com to create one.</span>
Username: openpowerquality
Password:
&lt;some lines removed&gt;

Login Succeeded
</code></pre>
<h4><a class="anchor" aria-hidden="true" id="invoke-the-publish-script"></a><a href="#invoke-the-publish-script" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Invoke the publish script</h4>
<p>We're publishing a new Mauka image, so <code>cd</code> into <code>opq/mauka/docker</code> and invoke the <code>docker-publish.sh</code> script.</p>
<p>When you invoke the <code>docker-publish.sh</code> script, it will provide information on how the image will be tagged, and give you an opportunity to abort the script should you need to make modifications.</p>
<p>As you can see below, the <code>docker-publish.sh</code> script simply tags Mauka's newest image <code>opqmauka:latest</code> as <code>openpowerquality/opqmauka:0.1.1</code> (as defined in the <code>.env</code> file), and pushes it to DockerHub.</p>
<p>Reminder: As we briefly explained in the 'Creating new Docker images' section, whenever you create a new image with the <code>docker-build.sh</code> script, Docker will automatically tag that new image with <code>latest</code>.</p>
<pre><code class="hljs">$ cd opq/mauka/docker
$ ./docker-publish.sh
=&gt; This will tag the 'opqmau<span class="hljs-symbol">ka:la</span>test' image as 'openpowerquality/opqmau<span class="hljs-symbol">ka:0</span>.<span class="hljs-number">1.1</span>' <span class="hljs-built_in">and</span> push to your Docker registry.
=&gt; <span class="hljs-built_in">If</span> you need to change the destination image tag (openpowerquality/opqmau<span class="hljs-symbol">ka:0</span>.<span class="hljs-number">1.1</span>), you can abort this script
<span class="hljs-built_in">and</span> modify the 'MAUKA_IMAGE' variable found in the 'opq/util/docker-deployment/.env' file.
=&gt; In addition, please ensure that you are logged into the correct Docker registry account before continuing.
=&gt; Continue? (y/<span class="hljs-built_in">n</span>)<span class="hljs-symbol">:</span> y
</code></pre>
<p>In our case, everything looks good, so we enter <code>y</code> to continue, and the image is then pushed to DockerHub!</p>
<pre><code class="hljs">=&gt; Tagging <span class="hljs-string">'opqmauka:latest'</span> image <span class="hljs-keyword">as</span> <span class="hljs-string">'openpowerquality/opqmauka:0.1.1'</span>...
=&gt; Pushing the <span class="hljs-string">'openpowerquality/opqmauka:0.1.1'</span> image <span class="hljs-keyword">to</span> registry...
The push refers <span class="hljs-keyword">to</span> repository [docker.io/openpowerquality/opqmauka]
<span class="hljs-number">3</span>c64a2f29066: Pushed
c40f7a899b1c: Pushed
<span class="hljs-number">16</span>cb62492495: Pushed
c9701db5aa5<span class="hljs-variable">b:</span> Layer already <span class="hljs-built_in">exists</span>
<span class="hljs-number">590</span>ee04d598<span class="hljs-variable">a:</span> Layer already <span class="hljs-built_in">exists</span>
a62b97ef6d9f: Layer already <span class="hljs-built_in">exists</span>
be59bd55864<span class="hljs-variable">a:</span> Layer already <span class="hljs-built_in">exists</span>
a19cb627cc73: Layer already <span class="hljs-built_in">exists</span>
ab016c9ea8f8: Layer already <span class="hljs-built_in">exists</span>
<span class="hljs-number">2</span>eb1c9bfc5e<span class="hljs-variable">a:</span> Layer already <span class="hljs-built_in">exists</span>
<span class="hljs-number">0</span>b703c74a09c: Layer already <span class="hljs-built_in">exists</span>
b28ef0b6fef8: Layer already <span class="hljs-built_in">exists</span>
<span class="hljs-number">0.1</span>.<span class="hljs-number">1</span>: diges<span class="hljs-variable">t:</span> <span class="hljs-built_in">sha256</span>:<span class="hljs-number">91</span>d592e4cc9c2febdfaf689a53d7a70a755de944801756b6015fdd974f41a1c4 size: <span class="hljs-number">2849</span>
</code></pre>
<p>Note: The <code>Layer already exists</code> messages are normal and should be expected. Docker images are built on layers, and knows how to effectively reuse layers from pre-existing images.</p>
<p>The image is now published!
You can visit the <a href="https://hub.docker.com/u/openpowerquality">official OPQ DockerHub</a> page to double check that your new image has been successfully published.</p>
<h4><a class="anchor" aria-hidden="true" id="commit-and-push-the-updated-env-file-to-github"></a><a href="#commit-and-push-the-updated-env-file-to-github" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Commit and push the updated <code>.env</code> file to GitHub</h4>
<p>As a final step, if you have modified the <code>.env</code> file in order to publish a new version (as we did in the Mauka example),
be sure to commit and push the file to GitHub with a useful commit message (e.g. <code>Publish Mauka 0.1.1</code>).</p>
<p>By doing so, we accomplish two useful things:</p>
<ol>
<li>The world is aware of the latest available Docker image versions for each OPQ service.</li>
<li>We can easily correlate OPQ releases with Git history.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="understanding-docker-compose-and-the-env-file-"></a><a href="#understanding-docker-compose-and-the-env-file-" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Understanding Docker-Compose and the .env file</h3>
<p>The <code>opq/util/docker-deployment</code> directory contains all of the Docker-Compose related files, the most important of which is the <code>docker-compose.yml</code> file.</p>
<p>The <code>docker-compose.yml</code> file is the configuration file for Docker-Compose, which is responsible for orchestrating how each of our OPQ services work together.
Among other things, this is where we define the Docker image to use for each service.</p>
<p>Rather than hard-coding each OPQ service’s image name directly into the <code>docker-compose.yml</code> file,
we instead opt to use the special <a href="https://docs.docker.com/compose/environment-variables/#the-env-file">Docker-Compose <code>.env</code> file</a> to hold environment variables for these values.
Later, when Docker-Compose is launched, these variables are automatically substituted into the <code>docker-compose.yml</code> file.</p>
<p>It’s important to understand that the image names used in our <code>.env</code> file are DockerHub-valid image names in the form of:</p>
<p><code>&lt;dockerhub-username&gt;/&lt;repository-name&gt;:&lt;tag&gt;</code></p>
<p>For example, <code>openpowerquality/opqview:1.2.8</code></p>
<p>Why does this matter? Because when Docker-Compose launches on the host system (or in our case, when we invoke the <code>docker-compose.run.sh</code> script), it will automatically pull these images from DockerHub if they have not been previously downloaded.
As you can imagine, this greatly simplifies the deployment process. Updating the system to run on the latest OPQ images is essentially just a matter of grabbing the latest <code>.env</code> file.</p>
<p>Our approach to image publication takes advantage of this <code>.env</code> file:</p>
<p>Each service’s respective <code>docker-publish.sh</code> script parses the Docker-Compose <code>.env</code> file for the appropriate image name.
Since these image names are, in fact, valid DockerHub repository image names, our <code>docker-publish.sh</code> script uses the image name to tag and push to DockerHub.</p>
<p>When a developer wishes to publish a new version of an OPQ service, it is simply a matter of modifying the <code>.env</code> file
with the new desired version prior to running the <code>docker-publish.sh</code> script.</p>
<p>It’s the developer’s responsibility to remember to commit the updated <code>.env</code> file to the GitHub repository.</p>
<p>By doing so, the developer ensures that:</p>
<ol>
<li>The world is aware of the latest available Docker image versions for each OPQ service.</li>
<li>We can easily correlate OPQ releases with Git history</li>
</ol>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="deploy-health.html">← Deployment: Health</a><a class="docs-next button" href="other-roadmap.html">Roadmap →</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#overview">Overview</a><ul class="toc-headings"><li><a href="#pre-requisites">Pre-requisites</a></li><li><a href="#overview-of-docker-related-files">Overview of Docker-related files</a></li></ul></li><li><a href="#deployment">Deployment</a><ul class="toc-headings"><li><a href="#deployment-walk-through">Deployment Walk-through</a></li></ul></li><li><a href="#developer-tasks">Developer Tasks</a><ul class="toc-headings"><li><a href="#creating-new-docker-images">Creating new Docker images</a></li><li><a href="#publishing-images-to-dockerhub">Publishing images to DockerHub</a></li><li><a href="#understanding-docker-compose-and-the-env-file-">Understanding Docker-Compose and the .env file</a></li></ul></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/opqlogo_white.png" alt="Open Power Quality" width="66" height="58"/></a><div><h5>Documentation Quick Links</h5><a href="/docs/intro-opq.html">Overview</a><a href="/docs/userguide-hardware.html">OPQ Box User Guide</a><a href="/docs/userguide-software.html">OPQ View User Guide</a><a href="/docs/other-agile-power-monitoring.html">Agile Power Monitoring for UH</a><a href="/docs/other-roadmap.html">Roadmap</a></div><div><h5>Community</h5><a href="https://openpowerquality.slack.com/" target="_blank" rel="noreferrer noopener">Slack</a><a href="https://twitter.com/opquality" target="_blank" rel="noreferrer noopener">Twitter</a><a href="/blog">News</a><a href="http://emilia.ics.hawaii.edu">Emilia (public OPQ View)</a><a href="/contact-us.html">Contact Us</a></div><div><h5>Development</h5><a href="https://github.com/openpowerquality">GitHub</a><a href="https://github.com/openpowerquality/opq/projects">Project Boards</a><a href="/team.html">Developer Team</a><a href="/docs/opportunities.html">Opportunities</a></div></section><p style="text-align:center;color:#e9faff">Open Power Quality is sponsored by:<br/><a style="text-align:center;color:#e9faff" href="http://csdl.ics.hawaii.edu">Collaborative Software Development Laboratory, University of Hawaii</a><br/><a style="text-align:center;color:#e9faff" href="http://www.ics.hawaii.edu">Department of Information and Computer Sciences, University of Hawaii</a><br/><a style="text-align:center;color:#e9faff" href="http://ee.hawaii.edu">Department of Electrical Engineering, University of Hawaii</a><br/></p></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              var search = docsearch({
                
                apiKey: '9bf16cc78135dbeeb3826894ebbbb2ee',
                indexName: 'openpowerquality',
                inputSelector: '#search_input_react'
              });
            </script></body></html>