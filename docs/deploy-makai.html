<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Deployment: Makai · Open Power Quality</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Deployment: Makai · Open Power Quality"/><meta property="og:type" content="website"/><meta property="og:url" content="https://openpowerquality.org/index.html"/><meta property="og:description" content="Makai has three main components: a Triggering Broker, an Acquisition Broker, and a Triggering Service (the makai daemon)."/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/opq.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><link rel="alternate" type="application/atom+xml" href="https://openpowerquality.org/blog/atom.xml" title="Open Power Quality Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://openpowerquality.org/blog/feed.xml" title="Open Power Quality Blog RSS Feed"/><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Gugi"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script><script type="text/javascript" src="/js/mathjax-config.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible doc separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/opqlogo_white.png" alt="Open Power Quality"/><h2 class="headerTitleWithLogo">Open Power Quality</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/intro-motivation.html" target="_self">Documentation</a></li><li class="siteNavGroupActive"><a href="/docs/other-opportunities.html" target="_self">Opportunities</a></li><li class=""><a href="/blog" target="_self">News</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Deployment</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Introduction</h3><ul><li class="navListItem"><a class="navItem" href="/docs/intro-motivation.html">Motivation for OPQ</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-power-quality.html">A beginner&#x27;s guide to power quality</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-system-architecture.html">OPQ System Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-information-architecture.html">OPQ Information Architecture</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-related-work.html">Related Work</a></li><li class="navListItem"><a class="navItem" href="/docs/intro-bibliography.html">Bibliography</a></li></ul></div><div class="navGroup navGroupActive"><h3>User Guide</h3><ul><li class="navListItem"><a class="navItem" href="/docs/userguide-hardware.html">OPQ Box</a></li><li class="navListItem"><a class="navItem" href="/docs/userguide-software.html">OPQ Cloud</a></li></ul></div><div class="navGroup navGroupActive"><h3>OPQ Box</h3><ul><li class="navListItem"><a class="navItem" href="/docs/box-overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/box-hardware-design.html">Hardware Design</a></li><li class="navListItem"><a class="navItem" href="/docs/box-software-design.html">Software Design</a></li><li class="navListItem"><a class="navItem" href="/docs/box-updater.html">Updater</a></li><li class="navListItem"><a class="navItem" href="/docs/box-manufacturing.html">Manufacturing</a></li></ul></div><div class="navGroup navGroupActive"><h3>OPQ Cloud</h3><ul><li class="navListItem"><a class="navItem" href="/docs/cloud-overview.html">Overview</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-datamodel.html">Data Model</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-view.html">View</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-mauka.html">Mauka</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-makai.html">Makai</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-health.html">Health</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-protocol.html">Protocol</a></li><li class="navListItem"><a class="navItem" href="/docs/cloud-port-map.html">Port Map</a></li></ul></div><div class="navGroup navGroupActive"><h3>Misc Development</h3><ul><li class="navListItem"><a class="navItem" href="/docs/developerguide-docusaurus.html">Documentation</a></li><li class="navListItem"><a class="navItem" href="/docs/developerguide-virtual-machine.html">VM &amp; Sim</a></li><li class="navListItem"><a class="navItem" href="/docs/developerguide-bibliography.html">Bibliography</a></li></ul></div><div class="navGroup navGroupActive"><h3>Deployment</h3><ul><li class="navListItem"><a class="navItem" href="/docs/deploy-initial-configuration.html">Initial Configuration</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-mongodb.html">MongoDB</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-mauka.html">Mauka</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/deploy-makai.html">Makai</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-view.html">View</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-health.html">Health</a></li><li class="navListItem"><a class="navItem" href="/docs/deploy-docker.html">Docker</a></li></ul></div><div class="navGroup navGroupActive"><h3>Other</h3><ul><li class="navListItem"><a class="navItem" href="/docs/other-roadmap.html">Roadmap</a></li><li class="navListItem"><a class="navItem" href="/docs/other-opportunities.html">R&amp;D Opportunities</a></li><li class="navListItem"><a class="navItem" href="/docs/other-agile-power-monitoring.html">Agile Power Monitoring for UH</a></li><li class="navListItem"><a class="navItem" href="/docs/other-g1-pilot-study.html">G1 Pilot Study (2014)</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Deployment: Makai</h1></header><article><div><span><p>Makai has three main components: a Triggering Broker, an Acquisition Broker, and a Triggering Service (the makai daemon).</p>
<p>Each one is a self-contained application, requiring their own dependencies. The Triggering and Acquisition Brokers are written in C++ and as such require C/C++ libraries. The Makai daemon, the core of the triggering service, is written in Rust. This make dependency management simpler because we can use the <code>cargo</code> system.</p>
<h2><a class="anchor" aria-hidden="true" id="installation-setup"></a><a href="#installation-setup" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Installation setup</h2>
<p>At this time, unlike other OPQ services, you must build the Makai service directly from sources on the server machine.</p>
<p>First, login as opquser on the server.</p>
<p>Change directories to the makai/ directory.</p>
<p>Next, checkout the <a href="https://github.com/openpowerquality/opq">opq repository</a> into this directory.</p>
<h2><a class="anchor" aria-hidden="true" id="one-step-install-and-deploy"></a><a href="#one-step-install-and-deploy" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>One step install and deploy</h2>
<p>As long as all the dependencies are satisfied, it is sufficient to run <code>build_and_install.sh</code> script in the opq/makai directory to install all the makai system, and configure it to run at startup. However, configuration files and need to be copied and edited manually to match your use case. For details, consult <a href="/docs/cloud-makai.html#configuration">Triggering Broker configuration</a>, <a href="/docs/cloud-makai.html#configuration-1">Acquisition Broker configuration</a>, and <a href="/docs/cloud-makai.html#configuration-2">Triggering Service configuration</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="individual-installation"></a><a href="#individual-installation" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Individual installation</h2>
<p>You can also build each component individually.  For details, consult <a href="/docs/cloud-makai.html#installation">Triggering Broker installation</a>, <a href="/docs/cloud-makai.html#installation-1">Acquisition Broker installation</a>, and <a href="/docs/cloud-makai.html#installation-2">Triggering Service installation</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="disabling-the-makai-service"></a><a href="#disabling-the-makai-service" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Disabling the Makai service</h2>
<p>To disable the Makai service:</p>
<p>Log into the server.</p>
<p>Ensure the that the service in currently running. We can use <code>sudo service --status-all</code> to list all services and ensure that <code>makai_service</code> is currently running.</p>
<pre><code class="hljs">opquser@emilia:~$ sudo service --status-all
[<span class="hljs-meta">sudo</span>] password <span class="hljs-keyword">for</span> opquser:
 [<span class="hljs-meta"> + </span>]  acpid
 [<span class="hljs-meta"> + </span>]  acq_broker
 [<span class="hljs-meta"> + </span>]  apache2
 [<span class="hljs-meta"> - </span>]  bootlogs
 [<span class="hljs-meta"> - </span>]  bootmisc.sh
 [<span class="hljs-meta"> - </span>]  checkfs.sh
 [<span class="hljs-meta"> - </span>]  checkroot-bootclean.sh
 [<span class="hljs-meta"> - </span>]  checkroot.sh
 [<span class="hljs-meta"> + </span>]  console-setup
 [<span class="hljs-meta"> + </span>]  cron
 [<span class="hljs-meta"> + </span>]  dbus
 [<span class="hljs-meta"> + </span>]  exim4
 [<span class="hljs-meta"> - </span>]  hostname.sh
 [<span class="hljs-meta"> - </span>]  hwclock.sh
 [<span class="hljs-meta"> + </span>]  irqbalance
 [<span class="hljs-meta"> + </span>]  jenkins
 [<span class="hljs-meta"> + </span>]  kbd
 [<span class="hljs-meta"> + </span>]  keyboard-setup
 [<span class="hljs-meta"> - </span>]  killprocs
 [<span class="hljs-meta"> + </span>]  kmod
 [<span class="hljs-meta"> + </span>]  makai_service
 [<span class="hljs-meta"> + </span>]  mauka
 [<span class="hljs-meta"> + </span>]  mongod
 [<span class="hljs-meta"> - </span>]  mongodrs
 [<span class="hljs-meta"> - </span>]  motd
 [<span class="hljs-meta"> - </span>]  mountall-bootclean.sh
 [<span class="hljs-meta"> - </span>]  mountall.sh
 [<span class="hljs-meta"> - </span>]  mountdevsubfs.sh
 [<span class="hljs-meta"> - </span>]  mountkernfs.sh
 [<span class="hljs-meta"> - </span>]  mountnfs-bootclean.sh
 [<span class="hljs-meta"> - </span>]  mountnfs.sh
 [<span class="hljs-meta"> + </span>]  networking
 [<span class="hljs-meta"> + </span>]  ntp
 [<span class="hljs-meta"> + </span>]  procps
 [<span class="hljs-meta"> + </span>]  rc.local
 [<span class="hljs-meta"> - </span>]  redis-server
 [<span class="hljs-meta"> - </span>]  rmnologin
 [<span class="hljs-meta"> - </span>]  rsync
 [<span class="hljs-meta"> + </span>]  rsyslog
 [<span class="hljs-meta"> - </span>]  saned
 [<span class="hljs-meta"> - </span>]  sendsigs
 [<span class="hljs-meta"> + </span>]  ssh
 [<span class="hljs-meta"> - </span>]  sudo
 [<span class="hljs-meta"> + </span>]  trg_broker
 [<span class="hljs-meta"> + </span>]  udev
 [<span class="hljs-meta"> + </span>]  udev-finish
 [<span class="hljs-meta"> - </span>]  umountfs
 [<span class="hljs-meta"> - </span>]  umountnfs.sh
 [<span class="hljs-meta"> - </span>]  umountroot
 [<span class="hljs-meta"> + </span>]  urandom
 [<span class="hljs-meta"> - </span>]  x11-common
</code></pre>
<p>Stop the service with <code>sudo service makai_service stop</code>, <code>sudo service acq_broker stop</code>, and <code>sudo service trg_broker stop</code>, and then ensure the service is no longer running.</p>
<pre><code class="hljs">opquser@emilia:~$ sudo service makai_service stop
opquser@emilia:~$ sudo service acq_broker stop
opquser@emilia:~$ sudo service trg_broker stop
opquser@emilia:~$ sudo service --status-all
 <span class="hljs-string">[ + ]</span>  acpid
 <span class="hljs-string">[ - ]</span>  acq_broker
 <span class="hljs-string">[ + ]</span>  apache2
 <span class="hljs-string">[ - ]</span>  bootlogs
 <span class="hljs-string">[ - ]</span>  bootmisc.sh
 <span class="hljs-string">[ - ]</span>  checkfs.sh
 <span class="hljs-string">[ - ]</span>  checkroot-bootclean.sh
 <span class="hljs-string">[ - ]</span>  checkroot.sh
 <span class="hljs-string">[ + ]</span>  console-setup
 <span class="hljs-string">[ + ]</span>  cron
 <span class="hljs-string">[ + ]</span>  dbus
 <span class="hljs-string">[ + ]</span>  exim4
 <span class="hljs-string">[ - ]</span>  hostname.sh
 <span class="hljs-string">[ - ]</span>  hwclock.sh
 <span class="hljs-string">[ + ]</span>  irqbalance
 <span class="hljs-string">[ + ]</span>  jenkins
 <span class="hljs-string">[ + ]</span>  kbd
 <span class="hljs-string">[ + ]</span>  keyboard-setup
 <span class="hljs-string">[ - ]</span>  killprocs
 <span class="hljs-string">[ + ]</span>  kmod
 <span class="hljs-string">[ - ]</span>  makai_service
 <span class="hljs-string">[ - ]</span>  mauka
 <span class="hljs-string">[ + ]</span>  mongod
 <span class="hljs-string">[ - ]</span>  mongodrs
 <span class="hljs-string">[ - ]</span>  motd
 <span class="hljs-string">[ - ]</span>  mountall-bootclean.sh
 <span class="hljs-string">[ - ]</span>  mountall.sh
 <span class="hljs-string">[ - ]</span>  mountdevsubfs.sh
 <span class="hljs-string">[ - ]</span>  mountkernfs.sh
 <span class="hljs-string">[ - ]</span>  mountnfs-bootclean.sh
 <span class="hljs-string">[ - ]</span>  mountnfs.sh
 <span class="hljs-string">[ + ]</span>  networking
 <span class="hljs-string">[ + ]</span>  ntp
 <span class="hljs-string">[ + ]</span>  procps
 <span class="hljs-string">[ + ]</span>  rc.local
 <span class="hljs-string">[ - ]</span>  redis-server
 <span class="hljs-string">[ - ]</span>  rmnologin
 <span class="hljs-string">[ - ]</span>  rsync
 <span class="hljs-string">[ + ]</span>  rsyslog
 <span class="hljs-string">[ - ]</span>  saned
 <span class="hljs-string">[ - ]</span>  sendsigs
 <span class="hljs-string">[ + ]</span>  ssh
 <span class="hljs-string">[ - ]</span>  sudo
 <span class="hljs-string">[ - ]</span>  trg_broker
 <span class="hljs-string">[ + ]</span>  udev
 <span class="hljs-string">[ + ]</span>  udev-finish
 <span class="hljs-string">[ - ]</span>  umountfs
 <span class="hljs-string">[ - ]</span>  umountnfs.sh
 <span class="hljs-string">[ - ]</span>  umountroot
 <span class="hljs-string">[ + ]</span>  urandom
 <span class="hljs-string">[ - ]</span>  x11-common
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="deploy-mauka.html">← Deployment: Mauka</a><a class="docs-next button" href="deploy-view.html">Deployment: View →</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#installation-setup">Installation setup</a></li><li><a href="#one-step-install-and-deploy">One step install and deploy</a></li><li><a href="#individual-installation">Individual installation</a></li><li><a href="#disabling-the-makai-service">Disabling the Makai service</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/opqlogo_white.png" alt="Open Power Quality" width="66" height="58"/></a><div><h5>Documentation Quick Links</h5><a href="/docs/intro-opq.html">Overview</a><a href="/docs/userguide-hardware.html">OPQ Box User Guide</a><a href="/docs/userguide-software.html">OPQ View User Guide</a><a href="/docs/other-agile-power-monitoring.html">Agile Power Monitoring for UH</a><a href="/docs/other-roadmap.html">Roadmap</a></div><div><h5>Community</h5><a href="https://openpowerquality.slack.com/" target="_blank" rel="noreferrer noopener">Slack</a><a href="https://twitter.com/opquality" target="_blank" rel="noreferrer noopener">Twitter</a><a href="/blog">News</a><a href="http://emilia.ics.hawaii.edu">Emilia (public OPQ View)</a><a href="/contact-us.html">Contact Us</a></div><div><h5>Development</h5><a href="https://github.com/openpowerquality">GitHub</a><a href="https://github.com/openpowerquality/opq/projects">Project Boards</a><a href="/team.html">Developer Team</a><a href="/docs/opportunities.html">Opportunities</a></div></section><p style="text-align:center;color:#e9faff">Open Power Quality is sponsored by:<br/><a style="text-align:center;color:#e9faff" href="http://csdl.ics.hawaii.edu">Collaborative Software Development Laboratory, University of Hawaii</a><br/><a style="text-align:center;color:#e9faff" href="http://www.ics.hawaii.edu">Department of Information and Computer Sciences, University of Hawaii</a><br/><a style="text-align:center;color:#e9faff" href="http://ee.hawaii.edu">Department of Electrical Engineering, University of Hawaii</a><br/></p></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
              var search = docsearch({
                
                apiKey: '9bf16cc78135dbeeb3826894ebbbb2ee',
                indexName: 'openpowerquality',
                inputSelector: '#search_input_react'
              });
            </script></body></html>